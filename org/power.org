#+TITLE: Руководство пользователя кластера OpenPOWER ВЦ ДВО РАН
#+OPTIONS: toc:t H:6 num:nil html-postamble:nil ^:nil tags:nil author:nil
#+SETUPFILE: theme-readtheorg-local.setup
#+HTML_HEAD: <style type="text/css">.org-src-name{ text-align: right; }</style>
#+HTML_HEAD: <style type="text/css">.outline-2{ margin-top: 60px; }</style>
\\
\\
Данное руководство содержит минимально необходимый объем информации
для работы на кластере ВЦ ДВО РАН: описание процесса регистрации,
сведения по работе в ОС Linux (вход в систему, работа с каталогами и
файлами, мониторинг) и работе с MPI программами и не параллельными
программами на кластере (компиляция, запуск, остановка, работа с
очередями). В тексте под термином параллельная программа
подразумеваются только MPI программы.

Команды и переменные командного
интерпретатора, названия программ, листинги, непосредственный
ввод/вывод консоли выделены моноширинным шрифтом.

Вопросы относительно работы кластера следует отправлять на /e-mail/:
[[mailto:support@hpc.febras.net][support@hpc.febras.net]].

Вопросы относительно этого документа (ошибки, неточности, предложения)
можно отправлять на /e-mail/: [[mailto:support@hpc.febras.net][support@hpc.febras.net]].

* Содержание :ignore:

#+TOC: headlines 3 local

* Регистрация

Регистрация пользователей на кластере происходит через систему ЦКП
http://ckp.ccfebras.ru.

* Вход в систему

Для работы с системой пользователь должен иметь свою учетную запись на
управляющем узле кластера. Регистрация пользователя на кластере
происходит в соответствии с предыдущей частью руководства. После
регистрации пользователь получает свое имя (логин), пароль и домашнюю
директорию. Если имя пользователя, например, будет *user*, то домашняя
папка находится в */home/user*.

При первом входе в систему предлагается сменить пароль. Требования к
новому паролю: он должен быть достаточной длины, содержать хотя бы 1
цифру и 1 заглавную букву. Директория =~/.ssh= содержит пару ключей
(/id_rsa/ и /authorized_keys/) для доступа к узлам кластера. При
добавлении личного ssh-ключа, необходимо добавить открытый ключ в файл
/authorized_keys/ через перенос строки (т.е. после уже имеющегося одного
открытого ключа).

Пользователи имеют возможность работать на кластере с любой машины,
находящейся в сети института и интернет. Для входа в систему
пользователю необходим адрес сервера ([[http://jupiter.febras.net][jupiter.febras.net]]), а также
имя и пароль, полученные при регистрации.

** Вход с Windows-машины

Работа с системой осуществляется по безопасному протоколу SSH при помощи какого-либо
ssh-клиента. Клиент должен поддерживать протокол версии 2. Рекомендуется использовать 
[[https://www.chiark.greenend.org.uk/~sgtatham/putty/][PuTTY]].
Эта программа является свободно распространяемой и проста в использовании.

После запуска программы (рис. 1) пользователь должен выбрать протокол
ssh и в поле «Host Name (or IP address)» указать адрес
сервера. Нажатие на «Open» приведет к отправке запроса на
подключение. В случае успешного подключения к серверу будет предложено
ввести имя (логин), а затем и пароль.

#+NAME: fig:putty
#+caption: Окно ssh-клиента PuTTY
[[./putty.png]]

При вводе пароля символы на экране не отображаются. Если все введено
правильно, то пользователь автоматически окажется в своей домашней
директории. Этот каталог доступен пользователю с любого узла кластера.

#+begin_note
*Примечание*. На кластере существует единое дисковое пространство для
директорий */opt* (только чтение) и */home*.  Все узлы используют
дисковый массив сервера посредством сетевой файловой системы NFS. Файл
записанный на одном из узлов кластера автоматически становится
доступен на любом другом.
#+end_note

Работа в ssh-сессии происходит в терминальном (текстовом, консольном)
режиме. Необходимо помнить, что консоль Linux, в отличии от Windows,
различает регистр вводимых символов, то есть =mydoc.txt= и =mydoc.TXT= не
одно и то же. После входа на экране отображается консоль командного
интерпретатора в следующем формате имя_пользователя@машина текущий_каталог:

#+begin_src raw
[user@jupiter ~]$
#+end_src

** Вход с терминала Linux

В любой дистрибутив ОС Linux входит терминальный ssh-клиент (обычно
OpenSSH). Минимальный формат команды для подключения к кластеру таков:

#+begin_src raw
[user@localhost ~]$ ssh jupiter.febras.net -l имя_пользователя
#+end_src

* Копирование файлов

* Работа на кластере

** Навигация

*** Консоль

*** mc

** Редактирование файлов

*** mc-edit

*** Emacs, VIM

** Компиляция программ

*** Замечания по разработке программ на отдельной машине

** Запуск задач

*** Диспетчеризация задач

Для диспетчеризации задач на кластере используется система PBS
Pro. С её помощью пользователь может отправлять свои задачи на
исполнение, снимать их с исполнения и получать информацию по текущему
статусу задачи.

Данная система построена на основе очередей, где под очередью
понимается набор пользовательских процессов (программ, задач)
выполняющихся в рамках системы диспетчеризации. Каждой очереди
сопоставлен ряд атрибутов, в зависимости от которых к задаче будут
применены те или иные действия. Типичными атрибутами являются название
(идентификатор) очереди, её приоритет, доступные ресурсы, количество
задач. В общем случае термин очередь не означает, то что программы в
ней будут выполняться строго последовательно.

Чтобы поставить задачу на исполнение, пользователь должен добавить ее
при помощи команды =qsub= в какую-либо очередь. Очереди отличаются
друг от друга совокупностью ресурсов, которыми они обладают.

*** Система очередей

На данный момент действует 1 очередь: /workq/.

Для получения информации об очередях, можно выполнить команду =qstat -q=.

#+begin_src raw
[eab@jupiter install]$ qstat -q

server: jupiter1

Queue            Memory CPU Time Walltime Node   Run   Que   Lm  State
---------------- ------ -------- -------- ---- ----- ----- ----  -----
workq              --      --       --     --      0     0   --   E R
                                               ----- -----
                                                   0     0

#+end_src

*Queue* – имя очереди; *Run* – число выполняемых задач; *Que* – число задач, ожидающих начала выполнения.

# Команда =qstat -Qf имя_очереди=  позволяет получить информацию о конкретной очереди.

*** Постановка задачи в очередь

*** Запуск интерактивных программ

*** Запуск непараллельных программ

*** Состояние пользовательских задач

*** Остановка задач

Остановка программы производится командой =qdel идентификатор_задачи=
#+begin_src raw
[user@jupiter ~]$ qdel 700
#+end_src

Этой командой задача, стоящая в очереди, убирается из нее, а
выполняющаяся задача снимается с выполнения. Следующая по очереди и
приоритету задача встает на выполнение.

Задача снимается в течении некоторого времени, поэтому при вызове
=qstat= непосредственно после =qdel= удаленная задача все еще может
быть отражена в таблице.

* Мониторинг

** Web-интерфейс

Мониторинг кластера реализован при помощи системы Ganglia. Эта система позволяет следить
за ресурсами кластера посредством web-интерфейса. Система мониторинга находится по адресу 
http://jupiter.febras.net/ganglia.

Для мониторинга пользователю доступно большое число типов ресурсов:
загруженность процессора, оперативная память, загрузка сети, средняя
загрузка, количество процессов и ряд других.  Имеется возможность
наблюдать как за всеми узлами в кластере (по одному параметру), так и
за каждым (по всем параметрам).


** Консоль

#+begin_src raw
[user@jupiter ~]$ pbsnodes jupiter2
jupiter2
     Mom = jupiter2
     Port = 15002
     pbs_version = 14.1.0
     ntype = PBS
     state = free
     pcpus = 160
     resources_available.arch = linux
     resources_available.host = jupiter2
     resources_available.mem = 263653568kb
     resources_available.ncpus = 160
     resources_available.ngpus = 2
     resources_available.vnode = jupiter2
     resources_assigned.accelerator_memory = 0kb
     resources_assigned.mem = 0kb
     resources_assigned.naccelerators = 0
     resources_assigned.ncpus = 0
     resources_assigned.netwins = 0
     resources_assigned.ngpus = 0
     resources_assigned.vmem = 0kb
     resv_enable = True
     sharing = default_shared

#+end_src

* Справочная информация

Описание основных команд при работе в ОС Linux – http://wwwinfo.jinr.ru/unixinfo/pc/lin_os.html
Документация к системе диспетчеризации заданий PBS Torque — http://www.pbsworks.com/pdfs/PBSUserGuide14.2.pdf
